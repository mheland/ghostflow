{"version":3,"sources":["selection-sharer.js"],"names":["$","SelectionSharer","options","self","this","elements","sel","textSelection","htmlSelection","appId","attr","url2share","window","location","href","getSelectionText","html","text","getSelection","rangeCount","container","document","createElement","i","len","appendChild","getRangeAt","cloneContents","textContent","innerHTML","selectionDirection","selection","range","createRange","anchorNode","setStart","anchorOffset","setEnd","focusNode","focusOffset","direction","collapsed","detach","showPopunder","popunder","getElementById","isCollapsed","length","match","hidePopunder","classList","contains","style","bottom","node","endContainer","parentNode","Math","ceil","getBoundingClientRect","top","nextElementSibling","pushSiblings","placeholder","className","margin","getComputedStyle","marginBottom","height","parseInt","insertBefore","offsetTop","pageYOffset","setTimeout","add","el","cb","remove","els","getElementsByClassName","body","show","e","getPosition","y","$popover","left","pageX","obj","offsetWidth","offsetLeft","offsetParent","width","removeClass","css","addClass","hide","smart_truncate","str","n","toLong","s_","substr","lastIndexOf","getRelatedTwitterAccounts","usernames","creator","push","anchors","getElementsByTagName","attributes","value","matches","indexOf","join","shareTwitter","preventDefault","trim","url","encodeURIComponent","viaTwitterAccount","screen","w","h","open","shareFacebook","replace","shareLinkedIn","shareEmail","email","subject","title","render","find","click","append","$popunder","setElements","$elements","mouseup","mousedown","bind","isMobile","onselectionchange","selectionChanged","lastSelectionChanged","clearTimeout","supportPageOffset","undefined","pageXOffset","isCSS1Compat","compatMode","x","documentElement","scrollLeft","scrollTop","fn","selectionSharer","define","load","name","req","onLoad","module","exports","jQuery"],"mappings":"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","file":"selection-sharer.js","sourcesContent":["/*\n * selection-sharer: Medium like popover menu to share on Twitter or by email any text selected on the page\n *\n * -- Requires jQuery --\n * -- AMD compatible  --\n *\n * Author: Xavier Damman (@xdamman)\n * GIT: https://github.com/xdamman/share-selection\n * MIT License\n */\n\n(function($) {\n  var SelectionSharer = function(options) {\n    var self = this;\n\n    options = options || {};\n    if (typeof options == 'string') options = { elements: options };\n\n    this.sel = null;\n    this.textSelection = '';\n    this.htmlSelection = '';\n\n    this.appId =\n      $('meta[property=\"fb:app_id\"]').attr('content') ||\n      $('meta[property=\"fb:app_id\"]').attr('value');\n    this.url2share =\n      $('meta[property=\"og:url\"]').attr('content') ||\n      $('meta[property=\"og:url\"]').attr('value') ||\n      window.location.href;\n\n    this.getSelectionText = function(sel) {\n      var html = '',\n        text = '';\n      sel = sel || window.getSelection();\n      if (sel.rangeCount) {\n        var container = document.createElement('div');\n        for (var i = 0, len = sel.rangeCount; i < len; ++i) {\n          container.appendChild(sel.getRangeAt(i).cloneContents());\n        }\n        text = container.textContent;\n        html = container.innerHTML;\n      }\n      self.textSelection = text;\n      self.htmlSelection = html || text;\n      return text;\n    };\n\n    this.selectionDirection = function(selection) {\n      var sel = selection || window.getSelection();\n      var range = document.createRange();\n      if (!sel.anchorNode) return 0;\n      range.setStart(sel.anchorNode, sel.anchorOffset);\n      range.setEnd(sel.focusNode, sel.focusOffset);\n      var direction = range.collapsed ? 'backward' : 'forward';\n      range.detach();\n      return direction;\n    };\n\n    this.showPopunder = function() {\n      self.popunder = self.popunder || document.getElementById('selectionSharerPopunder');\n\n      var sel = window.getSelection();\n      var selection = self.getSelectionText(sel);\n\n      if (sel.isCollapsed || selection.length < 10 || !selection.match(/ /))\n        return self.hidePopunder();\n\n      if (self.popunder.classList.contains('fixed')) {\n        self.popunder.style.bottom = 0;\n        return self.popunder.style.bottom;\n      }\n\n      var range = sel.getRangeAt(0);\n      var node = range.endContainer.parentNode; // The <p> where the selection ends\n\n      // If the popunder is currently displayed\n      if (self.popunder.classList.contains('show')) {\n        // If the popunder is already at the right place, we do nothing\n        if (\n          Math.ceil(self.popunder.getBoundingClientRect().top) ==\n          Math.ceil(node.getBoundingClientRect().bottom)\n        )\n          return;\n\n        // Otherwise, we first hide it and the we try again\n        return self.hidePopunder(self.showPopunder);\n      }\n\n      if (node.nextElementSibling) {\n        // We need to push down all the following siblings\n        self.pushSiblings(node);\n      } else {\n        // We need to append a new element to push all the content below\n        if (!self.placeholder) {\n          self.placeholder = document.createElement('div');\n          self.placeholder.className = 'selectionSharerPlaceholder';\n        }\n\n        // If we add a div between two <p> that have a 1em margin, the space between them\n        // will become 2x 1em. So we give the placeholder a negative margin to avoid that\n        var margin = window.getComputedStyle(node).marginBottom;\n        self.placeholder.style.height = margin;\n        self.placeholder.style.marginBottom = -2 * parseInt(margin, 10) + 'px';\n        node.parentNode.insertBefore(self.placeholder);\n      }\n\n      // scroll offset\n      var offsetTop = window.pageYOffset + node.getBoundingClientRect().bottom;\n      self.popunder.style.top = Math.ceil(offsetTop) + 'px';\n\n      setTimeout(function() {\n        if (self.placeholder) self.placeholder.classList.add('show');\n        self.popunder.classList.add('show');\n      }, 0);\n    };\n\n    this.pushSiblings = function(el) {\n      while ((el = el.nextElementSibling)) {\n        el.classList.add('selectionSharer');\n        el.classList.add('moveDown');\n      }\n    };\n\n    this.hidePopunder = function(cb) {\n      cb = cb || function() {};\n\n      if (self.popunder == 'fixed') {\n        self.popunder.style.bottom = '-50px';\n        return cb();\n      }\n\n      self.popunder.classList.remove('show');\n      if (self.placeholder) self.placeholder.classList.remove('show');\n      // We need to push back up all the siblings\n      var el;\n      var els = document.getElementsByClassName('moveDown');\n      while ((el = els[0])) el.classList.remove('moveDown');\n\n      // CSS3 transition takes 0.6s\n      setTimeout(function() {\n        if (self.placeholder) document.body.insertBefore(self.placeholder);\n        cb();\n      }, 600);\n    };\n\n    this.show = function(e) {\n      setTimeout(function() {\n        var sel = window.getSelection();\n        var selection = self.getSelectionText(sel);\n        if (!sel.isCollapsed && selection && selection.length > 10 && selection.match(/ /)) {\n          var range = sel.getRangeAt(0);\n          var topOffset = range.getBoundingClientRect().top - 5;\n          var top = topOffset + self.getPosition().y - self.$popover.height();\n          var left = 0;\n          if (e) {\n            left = e.pageX;\n          } else {\n            var obj = sel.anchorNode.parentNode;\n            left += obj.offsetWidth / 2;\n            do {\n              left += obj.offsetLeft;\n            } while ((obj = obj.offsetParent));\n          }\n          switch (self.selectionDirection(sel)) {\n            case 'forward':\n              left -= self.$popover.width();\n              break;\n            case 'backward':\n              left += self.$popover.width();\n              break;\n            default:\n              return;\n          }\n          self.$popover\n            .removeClass('anim')\n            .css('top', top + 10)\n            .css('left', left)\n            .show();\n          setTimeout(function() {\n            self.$popover.addClass('anim').css('top', top);\n          }, 0);\n        }\n      }, 10);\n    };\n\n    this.hide = function() {\n      self.$popover.hide();\n    };\n\n    this.smart_truncate = function(str, n) {\n      if (!str || !str.length) return str;\n      var toLong = str.length > n,\n        s_ = toLong ? str.substr(0, n - 1) : str;\n      s_ = toLong ? s_.substr(0, s_.lastIndexOf(' ')) : s_;\n      return toLong ? s_ + '...' : s_;\n    };\n\n    this.getRelatedTwitterAccounts = function() {\n      var usernames = [];\n\n      var creator =\n        $('meta[name=\"twitter:creator\"]').attr('content') ||\n        $('meta[name=\"twitter:creator\"]').attr('value');\n      if (creator) usernames.push(creator);\n\n      // We scrape the page to find a link to http(s)://twitter.com/username\n      var anchors = document.getElementsByTagName('a');\n      for (var i = 0, len = anchors.length; i < len; i++) {\n        if (anchors[i].attributes.href && typeof anchors[i].attributes.href.value == 'string') {\n          var matches = anchors[i].attributes.href.value.match(\n            /^https?:\\/\\/twitter\\.com\\/([a-z0-9_]{1,20})/i\n          );\n          if (matches && matches.length > 1 && ['widgets', 'intent'].indexOf(matches[1]) == -1)\n            usernames.push(matches[1]);\n        }\n      }\n\n      if (usernames.length > 0) return usernames.join(',');\n      else return '';\n    };\n\n    this.shareTwitter = function(e) {\n      e.preventDefault();\n\n      var text = '“' + self.smart_truncate(self.textSelection.trim(), 114) + '”';\n      var url =\n        'http://twitter.com/intent/tweet?text=' +\n        encodeURIComponent(text) +\n        '&related=' +\n        self.getRelatedTwitterAccounts() +\n        '&url=' +\n        encodeURIComponent(self.url2share);\n\n      // We only show the via @twitter:site if we have enough room\n      if (self.viaTwitterAccount && text.length < 120 - 6 - self.viaTwitterAccount.length)\n        url += '&via=' + self.viaTwitterAccount;\n\n      var w = 640,\n        h = 440;\n      var left = screen.width / 2 - w / 2;\n      var top = screen.height / 2 - h / 2 - 100;\n      window.open(\n        url,\n        'share_twitter',\n        'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=' +\n          w +\n          ', height=' +\n          h +\n          ', top=' +\n          top +\n          ', left=' +\n          left\n      );\n      self.hide();\n      return false;\n    };\n\n    this.shareFacebook = function(e) {\n      e.preventDefault();\n      var text = self.htmlSelection\n        .replace(/<p[^>]*>/gi, '\\n')\n        .replace(/<\\/p>| {2}/gi, '')\n        .trim();\n\n      var url =\n        'https://www.facebook.com/dialog/feed?' +\n        'app_id=' +\n        self.appId +\n        '&display=popup' +\n        '&caption=' +\n        encodeURIComponent(text) +\n        '&link=' +\n        encodeURIComponent(self.url2share) +\n        '&href=' +\n        encodeURIComponent(self.url2share) +\n        '&redirect_uri=' +\n        encodeURIComponent(self.url2share);\n      var w = 640,\n        h = 440;\n      var left = screen.width / 2 - w / 2;\n      var top = screen.height / 2 - h / 2 - 100;\n\n      window.open(\n        url,\n        'share_facebook',\n        'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=' +\n          w +\n          ', height=' +\n          h +\n          ', top=' +\n          top +\n          ', left=' +\n          left\n      );\n    };\n\n    this.shareLinkedIn = function(e) {\n      e.preventDefault();\n      var text = self.htmlSelection\n        .replace(/<p[^>]*>/gi, '\\n')\n        .replace(/<\\/p>| {2}/gi, '')\n        .trim();\n      var url =\n        'https://www.linkedin.com/shareArticle?mini=true&url=' +\n        encodeURIComponent(self.url2share) +\n        '&title=' +\n        encodeURIComponent(text);\n      var w = 640,\n        h = 440;\n      var left = screen.width / 2 - w / 2;\n      var top = screen.height / 2 - h / 2 - 100;\n      window.open(\n        url,\n        'share_linkedin',\n        'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=' +\n          w +\n          ', height=' +\n          h +\n          ', top=' +\n          top +\n          ', left=' +\n          left\n      );\n    };\n\n    this.shareEmail = function() {\n      var text = self.textSelection\n        .replace(/<p[^>]*>/gi, '\\n')\n        .replace(/<\\/p>| {2}/gi, '')\n        .trim();\n      var email = {};\n      email.subject = encodeURIComponent('Quote from ' + document.title);\n      email.body =\n        encodeURIComponent('“' + text + '”') +\n        '%0D%0A%0D%0AFrom: ' +\n        document.title +\n        '%0D%0A' +\n        window.location.href;\n      $(this).attr('href', 'mailto:?subject=' + email.subject + '&body=' + email.body);\n      self.hide();\n      return true;\n    };\n\n    this.render = function() {\n      var popoverHTML =\n        '<div class=\"selectionSharer\" id=\"selectionSharerPopover\" style=\"position:absolute;\">' +\n        '  <div id=\"selectionSharerPopover-inner\">' +\n        '    <ul>' +\n        '      <li><a class=\"action tweet\" href=\"\" title=\"Dela markering på Twitter\" target=\"_blank\">Tweet</a></li>' +\n        '      <li><a class=\"action facebook\" href=\"\" title=\"Dela markering på  Facebook\" target=\"_blank\">Facebook</a></li>' +\n        '      <li><a class=\"action linkedin\" href=\"\" title=\"Dela markering på  LinkedIn\" target=\"_blank\">LinkedIn</a></li>' +\n        '      <li><a class=\"action email\" href=\"\" title=\"Dela markering med epost\" target=\"_blank\"><svg width=\"20\" height=\"20\"><path stroke=\"%23FFF\" stroke-width=\"6\" d=\"m16,25h82v60H16zl37,37q4,3 8,0l37-37M16,85l30-30m22,0 30,30\"/></svg></a></li>' +\n        '    </ul>' +\n        '  </div>' +\n        '  <div class=\"selectionSharerPopover-clip\"><span class=\"selectionSharerPopover-arrow\"></span></div>' +\n        '</div>';\n\n      var popunderHTML =\n        '<div id=\"selectionSharerPopunder\" class=\"selectionSharer\">' +\n        '  <div id=\"selectionSharerPopunder-inner\">' +\n        '    <label>Share this selection</label>' +\n        '    <ul>' +\n        '      <li><a class=\"action tweet\" href=\"\" title=\"Dela markering på Twitter\" target=\"_blank\">Tweet</a></li>' +\n        '      <li><a class=\"action facebook\" href=\"\" title=\"Dela markering på Facebook\" target=\"_blank\">Facebook</a></li>' +\n        '      <li><a class=\"action linkedin\" href=\"\" title=\"Dela markering på LinkedIn\" target=\"_blank\">LinkedIn</a></li>' +\n        '      <li><a class=\"action email\" href=\"\" title=\"Dela markering med epost\" target=\"_blank\"><svg width=\"20\" height=\"20\"><path stroke=\"%23FFF\" stroke-width=\"6\" d=\"m16,25h82v60H16zl37,37q4,3 8,0l37-37M16,85l30-30m22,0 30,30\"/></svg></a></li>' +\n        '    </ul>' +\n        '  </div>' +\n        '</div>';\n      self.$popover = $(popoverHTML);\n      self.$popover.find('a.tweet').click(self.shareTwitter);\n      self.$popover.find('a.facebook').click(self.shareFacebook);\n      self.$popover.find('a.linkedin').click(self.shareLinkedIn);\n      self.$popover.find('a.email').click(self.shareEmail);\n      $('body').append(self.$popover);\n\n      self.$popunder = $(popunderHTML);\n      self.$popunder.find('a.tweet').click(self.shareTwitter);\n      self.$popunder.find('a.facebook').click(self.shareFacebook);\n      self.$popover.find('a.linkedin').click(self.shareLinkedIn);\n      self.$popunder.find('a.email').click(self.shareEmail);\n      $('body').append(self.$popunder);\n\n      if (self.appId && self.url2share) {\n        $('.selectionSharer a.facebook').css('display', 'inline-block');\n      }\n    };\n\n    this.setElements = function(elements) {\n      if (typeof elements == 'string') elements = $(elements);\n      self.$elements = elements instanceof $ ? elements : $(elements);\n      self.$elements\n        .mouseup(self.show)\n        .mousedown(self.hide)\n        .addClass('selectionShareable');\n\n      self.$elements.bind('touchstart', function() {\n        self.isMobile = true;\n      });\n\n      document.onselectionchange = self.selectionChanged;\n    };\n\n    this.selectionChanged = function(e) {\n      if (!self.isMobile) return;\n\n      if (self.lastSelectionChanged) {\n        clearTimeout(self.lastSelectionChanged);\n      }\n      self.lastSelectionChanged = setTimeout(function() {\n        self.showPopunder(e);\n      }, 300);\n    };\n\n    this.getPosition = function() {\n      var supportPageOffset = window.pageXOffset !== undefined;\n      var isCSS1Compat = (document.compatMode || '') === 'CSS1Compat';\n\n      var x = supportPageOffset\n        ? window.pageXOffset\n        : isCSS1Compat\n        ? document.documentElement.scrollLeft\n        : document.body.scrollLeft;\n      var y = supportPageOffset\n        ? window.pageYOffset\n        : isCSS1Compat\n        ? document.documentElement.scrollTop\n        : document.body.scrollTop;\n      return { x: x, y: y };\n    };\n\n    this.render();\n\n    if (options.elements) {\n      this.setElements(options.elements);\n    }\n  };\n\n  // jQuery plugin\n  // Usage: $( \"p\" ).selectionSharer();\n  $.fn.selectionSharer = function() {\n    var sharer = new SelectionSharer();\n    sharer.setElements(this);\n    return this;\n  };\n\n  // For AMD / requirejs\n  // Usage: require([\"selection-sharer!\"]);\n  //     or require([\"selection-sharer\"], function(selectionSharer) { var sharer = new SelectionSharer('p'); });\n  if (typeof define == 'function') {\n    define(function() {\n      SelectionSharer.load = function(name, req, onLoad) {\n        var sharer = new SelectionSharer();\n        sharer.setElements('p');\n        onLoad();\n      };\n      return SelectionSharer;\n    });\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = SelectionSharer;\n  } else {\n    // Registering SelectionSharer as a global\n    // Usage: var sharer = new SelectionSharer('p');\n    window.SelectionSharer = SelectionSharer;\n  }\n})(jQuery);\n"]}