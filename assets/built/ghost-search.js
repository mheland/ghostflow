function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof module&&module.exports?module.exports=r():e.fuzzysort=r()}(this,function(){var L="undefined"!=typeof require&&"undefined"==typeof window,t=new Map,n=new Map,j=[];j.total=0;var k=[],w=[];function r(){t.clear(),n.clear(),k=[],w=[]}function q(e){for(var r=-9007199254740991,t=e.length-1;0<=t;--t){var n=e[t];if(null!==n){var o=n.score;r<o&&(r=o)}}return-9007199254740991===r?null:r}function B(e,r){var t=e[r];if(void 0!==t)return t;var n=r;Array.isArray(r)||(n=r.split("."));for(var o=n.length,i=-1;e&&++i<o;)e=e[n[i]];return e}function D(e){return"object"==typeof e}var o=function(){var i=[],l=0,e={};function r(){for(var e=0,r=i[e],t=1;t<l;){var n=t+1;e=t,n<l&&i[n].score<i[t].score&&(e=n),i[e-1>>1]=i[e],t=1+(e<<1)}for(var o=e-1>>1;0<e&&r.score<i[o].score;o=(e=o)-1>>1)i[e]=i[o];i[e]=r}return e.add=function(e){var r=l;i[l++]=e;for(var t=r-1>>1;0<r&&e.score<i[t].score;t=(r=t)-1>>1)i[r]=i[t];i[r]=e},e.poll=function(){if(0!==l){var e=i[0];return i[0]=i[--l],r(),e}},e.peek=function(e){if(0!==l)return i[0]},e.replaceTop=function(e){i[0]=e,r()},e},x=o();return function e(P){var I={single:function(e,r,t){return e?(D(e)||(e=I.getPreparedSearch(e)),r?(D(r)||(r=I.getPrepared(r)),((t&&void 0!==t.allowTypo?t.allowTypo:!P||void 0===P.allowTypo||P.allowTypo)?I.algorithm:I.algorithmNoTypo)(e,r,e[0])):null):null},go:function(e,r,t){if(!e)return j;var n=(e=I.prepareSearch(e))[0],o=t&&t.threshold||P&&P.threshold||-9007199254740991,i=t&&t.limit||P&&P.limit||9007199254740991,l=(t&&void 0!==t.allowTypo?t.allowTypo:!P||void 0===P.allowTypo||P.allowTypo)?I.algorithm:I.algorithmNoTypo,a=0,s=0,u=r.length;if(t&&t.keys)for(var c=t.scoreFn||q,f=t.keys,d=f.length,p=u-1;0<=p;--p){for(var h=r[p],g=new Array(d),y=d-1;0<=y;--y)(b=B(h,m=f[y]))?(D(b)||(b=I.getPrepared(b)),g[y]=l(e,b,n)):g[y]=null;g.obj=h;var v=c(g);null!==v&&(v<o||(g.score=v,a<i?(x.add(g),++a):(++s,v>x.peek().score&&x.replaceTop(g))))}else if(t&&t.key){var m=t.key;for(p=u-1;0<=p;--p)(b=B(h=r[p],m))&&(D(b)||(b=I.getPrepared(b)),null!==(k=l(e,b,n))&&(k.score<o||(k={target:k.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:k.score,indexes:k.indexes,obj:h},a<i?(x.add(k),++a):(++s,k.score>x.peek().score&&x.replaceTop(k)))))}else for(p=u-1;0<=p;--p){var b,k;(b=r[p])&&(D(b)||(b=I.getPrepared(b)),null!==(k=l(e,b,n))&&(k.score<o||(a<i?(x.add(k),++a):(++s,k.score>x.peek().score&&x.replaceTop(k)))))}if(0===a)return j;var w=new Array(a);for(p=a-1;0<=p;--p)w[p]=x.poll();return w.total=a+s,w},goAsync:function(T,C,_){var S=!1,e=new Promise(function(p,h){if(!T)return p(j);var g=(T=I.prepareSearch(T))[0],y=o(),v=C.length-1,m=_&&_.threshold||P&&P.threshold||-9007199254740991,b=_&&_.limit||P&&P.limit||9007199254740991,k=(_&&void 0!==_.allowTypo?_.allowTypo:!P||void 0===P.allowTypo||P.allowTypo)?I.algorithm:I.algorithmNoTypo,w=0,x=0;function A(){if(S)return h("canceled");var e=Date.now();if(_&&_.keys)for(var r=_.scoreFn||q,t=_.keys,n=t.length;0<=v;--v){for(var o=C[v],i=new Array(n),l=n-1;0<=l;--l)(u=B(o,s=t[l]))?(D(u)||(u=I.getPrepared(u)),i[l]=k(T,u,g)):i[l]=null;i.obj=o;var a=r(i);if(null!==a&&!(a<m)&&(i.score=a,w<b?(y.add(i),++w):(++x,a>y.peek().score&&y.replaceTop(i)),v%1e3==0&&10<=Date.now()-e))return void(L?setImmediate(A):setTimeout(A))}else if(_&&_.key){for(var s=_.key;0<=v;--v)if((u=B(o=C[v],s))&&(D(u)||(u=I.getPrepared(u)),null!==(c=k(T,u,g))&&!(c.score<m)&&(c={target:c.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:c.score,indexes:c.indexes,obj:o},w<b?(y.add(c),++w):(++x,c.score>y.peek().score&&y.replaceTop(c)),v%1e3==0&&10<=Date.now()-e)))return void(L?setImmediate(A):setTimeout(A))}else for(;0<=v;--v){var u,c;if((u=C[v])&&(D(u)||(u=I.getPrepared(u)),null!==(c=k(T,u,g))&&!(c.score<m)&&(w<b?(y.add(c),++w):(++x,c.score>y.peek().score&&y.replaceTop(c)),v%1e3==0&&10<=Date.now()-e)))return void(L?setImmediate(A):setTimeout(A))}if(0===w)return p(j);for(var f=new Array(w),d=w-1;0<=d;--d)f[d]=y.poll();f.total=w+x,p(f)}L?setImmediate(A):A()});return e.cancel=function(){S=!0},e},highlight:function(e,r,t){if(null===e)return null;void 0===r&&(r="<b>"),void 0===t&&(t="</b>");for(var n="",o=0,i=!1,l=e.target,a=l.length,s=e.indexes,u=0;u<a;++u){var c=l[u];if(s[o]===u){if(i||(i=!0,n+=r),++o===s.length){n+=c+t+l.substr(u+1);break}}else i&&(i=!1,n+=t);n+=c}return n},prepare:function(e){if(e)return{target:e,_targetLowerCodes:I.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(e){if(e)return{target:e,_targetLowerCodes:I.prepareLowerCodes(e),_nextBeginningIndexes:I.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){if(e)return I.prepareLowerCodes(e)},getPrepared:function(e){if(999<e.length)return I.prepare(e);var r=t.get(e);return void 0!==r||(r=I.prepare(e),t.set(e,r)),r},getPreparedSearch:function(e){if(999<e.length)return I.prepareSearch(e);var r=n.get(e);return void 0!==r||(r=I.prepareSearch(e),n.set(e,r)),r},algorithm:function(e,r,t){for(var n=r._targetLowerCodes,o=e.length,i=n.length,l=0,a=0,s=0,u=0;;){if(t===n[a]){if(k[u++]=a,++l===o)break;t=e[0===s?l:s===l?l+1:s===l-1?l-1:l]}if(i<=++a)for(;;){if(l<=1)return null;if(0===s){if(t===e[--l])continue;s=l}else{if(1===s)return null;if((t=e[1+(l=--s)])===e[l])continue}a=k[(u=l)-1]+1;break}}var c=l=0,f=!1,d=0,p=r._nextBeginningIndexes;null===p&&(p=r._nextBeginningIndexes=I.prepareNextBeginningIndexes(r.target));var h=a=0===k[0]?0:p[k[0]-1];if(a!==i)for(;;)if(i<=a){if(l<=0){if(o-2<++c)break;if(e[c]===e[c+1])continue;a=h;continue}--l,a=p[w[--d]]}else if(e[0===c?l:c===l?l+1:c===l-1?l-1:l]===n[a]){if(w[d++]=a,++l===o){f=!0;break}++a}else a=p[a];if(f)var g=w,y=d;else g=k,y=u;for(var v=0,m=-1,b=0;b<o;++b)m!==(a=g[b])-1&&(v-=a),m=a;for(f?0!==c&&(v+=-20):(v*=1e3,0!==s&&(v+=-20)),v-=i-o,r.score=v,r.indexes=new Array(y),b=y-1;0<=b;--b)r.indexes[b]=g[b];return r},algorithmNoTypo:function(e,r,t){for(var n=r._targetLowerCodes,o=e.length,i=n.length,l=0,a=0,s=0;;){if(t===n[a]){if(k[s++]=a,++l===o)break;t=e[l]}if(i<=++a)return null}var u=!1,c=l=0,f=r._nextBeginningIndexes;if(null===f&&(f=r._nextBeginningIndexes=I.prepareNextBeginningIndexes(r.target)),(a=0===k[0]?0:f[k[0]-1])!==i)for(;;)if(i<=a){if(l<=0)break;--l,a=f[w[--c]]}else if(e[l]===n[a]){if(w[c++]=a,++l===o){u=!0;break}++a}else a=f[a];if(u)var d=w,p=c;else d=k,p=s;for(var h=0,g=-1,y=0;y<o;++y)g!==(a=d[y])-1&&(h-=a),g=a;for(u||(h*=1e3),h-=i-o,r.score=h,r.indexes=new Array(p),y=p-1;0<=y;--y)r.indexes[y]=d[y];return r},prepareLowerCodes:function(e){for(var r=e.length,t=[],n=e.toLowerCase(),o=0;o<r;++o)t[o]=n.charCodeAt(o);return t},prepareBeginningIndexes:function(e){for(var r=e.length,t=[],n=0,o=!1,i=!1,l=0;l<r;++l){var a=e.charCodeAt(l),s=65<=a&&a<=90,u=s||97<=a&&a<=122||48<=a&&a<=57,c=s&&!o||!i||!u;o=s,i=u,c&&(t[n++]=l)}return t},prepareNextBeginningIndexes:function(e){for(var r=e.length,t=I.prepareBeginningIndexes(e),n=[],o=t[0],i=0,l=0;l<r;++l)l<o?n[l]=o:(o=t[++i],n[l]=void 0===o?r:o);return n},cleanup:r,new:e};return I}()});var GhostSearch=function(){function n(e){_classCallCheck(this,n);var r={host:"",key:"",version:"v2",input:"#ghost-search-field",results:"#ghost-search-results",button:"",defaultValue:"",template:function(e){return'<a href="'+[location.protocol,"//",location.host].join("")+"/"+e.slug+'/">'+e.title+"</a>"},trigger:"focus",options:{keys:["title"],limit:10,threshold:-3500,allowTypo:this.check=!1},api:{resource:"posts",parameters:{limit:"all",fields:["title","slug"],filter:"",include:"",order:"",formats:"",page:""}},on:{beforeDisplay:function(){},afterDisplay:function(){},beforeFetch:function(){},afterFetch:function(){}}},t=this.mergeDeep(r,e);Object.assign(this,t),this.init()}return _createClass(n,[{key:"mergeDeep",value:function(r,t){var n=this;return r&&"object"===_typeof(r)&&!Array.isArray(r)&&null!==r&&t&&"object"===_typeof(t)&&!Array.isArray(t)&&null!==t&&Object.keys(t).forEach(function(e){t[e]&&"object"===_typeof(t[e])&&!Array.isArray(t[e])&&null!==t[e]?(r[e]||Object.assign(r,_defineProperty({},e,{})),n.mergeDeep(r[e],t[e])):Object.assign(r,_defineProperty({},e,t[e]))}),r}},{key:"fetch",value:function(){var r=this;this.on.beforeFetch();var e=new GhostContentAPI({host:this.host,key:this.key,version:this.version}),t={},n=this.api.parameters;for(var o in n)""!=n[o]&&(t[o]=n[o]);e[this.api.resource].browse(t).then(function(e){r.search(e)}).catch(function(e){console.error(e)})}},{key:"createElementFromHTML",value:function(e){var r=document.createElement("div");return r.innerHTML=e.trim(),r.firstChild}},{key:"displayResults",value:function(e){if(null!==document.querySelectorAll(this.results)[0].firstChild&&""!==document.querySelectorAll(this.results)[0].firstChild)for(;document.querySelectorAll(this.results)[0].firstChild;)document.querySelectorAll(this.results)[0].removeChild(document.querySelectorAll(this.results)[0].firstChild);var r=document.querySelectorAll(this.input)[0].value;""!=this.defaultValue&&(r=this.defaultValue);var t=fuzzysort.go(r,e,{keys:this.options.keys,limit:this.options.limit,allowTypo:this.options.allowTypo,threshold:this.options.threshold});for(var n in t)n<t.length&&document.querySelectorAll(this.results)[0].appendChild(this.createElementFromHTML(this.template(t[n].obj)));this.on.afterDisplay(t),this.defaultValue=""}},{key:"search",value:function(r){var t=this;if(this.on.afterFetch(r),this.check=!0,""!=this.defaultValue&&(this.on.beforeDisplay(),this.displayResults(r)),""!=this.button){var e=document.querySelectorAll(this.button)[0];"INPUT"==e.tagName&&"submit"==e.type&&e.closest("form").addEventListener("submit",function(e){e.preventDefault()}),e.addEventListener("click",function(e){e.preventDefault(),t.on.beforeDisplay(),t.displayResults(r)})}else document.querySelectorAll(this.input)[0].addEventListener("keyup",function(e){t.on.beforeDisplay(),t.displayResults(r)})}},{key:"checkArgs",value:function(){return document.querySelectorAll(this.input).length?document.querySelectorAll(this.results).length?""==this.button||document.querySelectorAll(this.button).length?""==this.host?(console.log("Content API Client Library host missing. Please set the host. Must not end in a trailing slash."),!1):""!=this.key||(console.log('Content API Client Library key missing. Please set the key. Hex string copied from the "Integrations" screen in Ghost Admin.'),!1):(console.log("Button not found."),!1):(console.log("Results not found."),!1):(console.log("Input not found."),!1)}},{key:"validate",value:function(){return!!this.checkArgs()}},{key:"init",value:function(){var r=this;this.validate()&&(""!=this.defaultValue&&(document.querySelectorAll(this.input)[0].value=this.defaultValue,window.onload=function(){r.check||r.fetch()}),"focus"==this.trigger?document.querySelectorAll(this.input)[0].addEventListener("focus",function(e){r.check||r.fetch()}):"load"==this.trigger&&(window.onload=function(){r.check||r.fetch()}))}}]),n}();
//# sourceMappingURL=ghost-search.js.map